import { useState } from "react";
import { useWallet } from "@/hooks/use-wallet";
import { useToast } from "@/hooks/use-toast";
import { WalletType } from "@/lib/web3";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";

interface WalletOption {
  id: WalletType;
  name: string;
  icon: React.ReactNode;
  description: string;
}

export function WalletSelector({ 
  isOpen, 
  onClose 
}: { 
  isOpen: boolean; 
  onClose: () => void 
}) {
  const { connectWallet } = useWallet();
  const { toast } = useToast();
  const [isConnecting, setIsConnecting] = useState(false);
  const [selectedWallet, setSelectedWallet] = useState<WalletType | null>(null);

  // Define wallet options with icons
  const walletOptions: WalletOption[] = [
    {
      id: "metamask",
      name: "MetaMask",
      icon: (
        <svg viewBox="0 0 35 33" width="32" height="32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M32.958 1L19.731 10.726L22.1944 4.98953L32.958 1Z" fill="#E17726" stroke="#E17726" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
          <path d="M2.07766 1L15.1787 10.8068L12.8427 4.98953L2.07766 1Z" fill="#E27625" stroke="#E27625" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
          <path d="M28.2019 23.4113L24.6489 28.7558L32.1173 30.8107L34.2827 23.5327L28.2019 23.4113Z" fill="#E27625" stroke="#E27625" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
          <path d="M0.75 23.5327L2.9045 30.8107L10.3622 28.7558L6.81987 23.4113L0.75 23.5327Z" fill="#E27625" stroke="#E27625" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
          <path d="M10.0038 14.4419L7.89685 17.5765L15.2771 17.9008L15.0365 9.93066L10.0038 14.4419Z" fill="#E27625" stroke="#E27625" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
          <path d="M24.9957 14.4422L19.8843 9.84985L19.731 17.9011L27.1113 17.5768L24.9957 14.4422Z" fill="#E27625" stroke="#E27625" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
          <path d="M10.3628 28.7559L14.8559 26.5981L10.9644 23.5841L10.3628 28.7559Z" fill="#E27625" stroke="#E27625" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
          <path d="M20.1445 26.5981L24.6483 28.7559L24.036 23.5841L20.1445 26.5981Z" fill="#E27625" stroke="#E27625" strokeWidth="0.25" strokeLinecap="round" strokeLinejoin="round"/>
        </svg>
      ),
      description: "Connect to your MetaMask wallet",
    },
    {
      id: "coinbase",
      name: "Coinbase Wallet",
      icon: (
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="16" cy="16" r="16" fill="#0052FF"/>
          <path d="M16.0008 6.4C10.6981 6.4 6.40039 10.6977 6.40039 16.0003C6.40039 21.303 10.6981 25.6007 16.0008 25.6007C21.3034 25.6007 25.6011 21.303 25.6011 16.0003C25.6011 10.6977 21.3034 6.4 16.0008 6.4ZM12.8002 19.2004C11.3198 19.2004 10.1199 18.0006 10.1199 16.5203C10.1199 15.0399 11.3198 13.8401 12.8002 13.8401C14.2805 13.8401 15.4803 15.0399 15.4803 16.5203C15.4803 18.0006 14.2805 19.2004 12.8002 19.2004ZM19.2012 19.2004C17.7209 19.2004 16.521 18.0006 16.521 16.5203C16.521 15.0399 17.7209 13.8401 19.2012 13.8401C20.6816 13.8401 21.8814 15.0399 21.8814 16.5203C21.8814 18.0006 20.6816 19.2004 19.2012 19.2004Z" fill="white"/>
        </svg>
      ),
      description: "Connect with Coinbase Wallet",
    },
    {
      id: "walletconnect",
      name: "WalletConnect",
      icon: (
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" rx="16" fill="#3B99FC"/>
          <path d="M10.1323 12.3813C13.3228 9.19083 18.4966 9.19083 21.6871 12.3813L22.1446 12.8388C22.3366 13.0308 22.3366 13.343 22.1446 13.535L20.9202 14.7594C20.8242 14.8554 20.6681 14.8554 20.5721 14.7594L19.9467 14.134C17.7334 11.9207 14.0864 11.9207 11.8731 14.134L11.2008 14.8063C11.1048 14.9023 10.9487 14.9023 10.8527 14.8063L9.62835 13.5819C9.43636 13.3899 9.43636 13.0777 9.62835 12.8857L10.1323 12.3813ZM24.6829 15.3771L25.7811 16.4753C25.9731 16.6673 25.9731 16.9795 25.7811 17.1715L20.5262 22.4268C20.3342 22.6188 20.022 22.6188 19.83 22.4268L16.2289 18.8253C16.1809 18.7773 16.1015 18.7773 16.0535 18.8253L12.4528 22.4268C12.2608 22.6188 11.9486 22.6188 11.7566 22.4268L6.49834 17.1711C6.30635 16.9791 6.30635 16.6669 6.49834 16.4749L7.59657 15.3771C7.78856 15.1851 8.10071 15.1851 8.2927 15.3771L11.8942 18.9786C11.9422 19.0266 12.0216 19.0266 12.0696 18.9786L15.6699 15.3771C15.8619 15.1851 16.1741 15.1851 16.366 15.3771L19.967 18.9786C20.015 19.0266 20.0944 19.0266 20.1424 18.9786L23.7433 15.3771C23.9357 15.1851 24.2479 15.1851 24.4398 15.3771H24.6829Z" fill="white"/>
        </svg>
      ),
      description: "Scan with WalletConnect to connect",
    },
    {
      id: "trust",
      name: "Trust Wallet",
      icon: (
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" rx="16" fill="#3375BB"/>
          <path d="M16.9425 7.72517C16.525 7.59442 15.475 7.59442 15.0575 7.72517C14.1725 8.01367 8 10.3062 8 10.3062V15.9612C8 21.2312 14.08 24.8637 15.2125 25.3662C15.5338 25.5225 15.7675 25.6 16 25.6C16.2325 25.6 16.4662 25.5225 16.7875 25.3662C17.92 24.8637 24 21.2312 24 15.9612V10.3062C24 10.3062 17.8275 8.01367 16.9425 7.72517ZM20.5 17.1437L19.12 18.5237L16 21.6437L12.88 18.5237L11.5 17.1437C11.1663 16.81 11.1663 16.2737 11.5 15.9487L12.88 14.5687C13.2138 14.235 13.75 14.235 14.075 14.5687L16 16.4937L17.925 14.5687C18.2588 14.235 18.795 14.235 19.12 14.5687L20.5 15.9487C20.8338 16.2825 20.8338 16.81 20.5 17.1437Z" fill="white"/>
        </svg>
      ),
      description: "Connect with Trust Wallet",
    },
    {
      id: "phantom",
      name: "Phantom",
      icon: (
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="32" height="32" rx="16" fill="#AB9FF2"/>
          <path d="M22.3202 10.3815C21.9782 10.1955 21.596 10.1099 21.212 10.1324C20.4253 10.1324 19.7032 10.5387 19.3271 11.2047L17.9837 13.5347C17.8762 13.7207 17.9297 13.9606 18.0907 14.0914C18.2511 14.2217 18.4886 14.1816 18.6091 14.0155L20.0003 11.6855C20.264 11.2047 20.7252 10.906 21.2331 10.8824C21.4867 10.8721 21.742 10.9365 21.9429 11.0842C22.1439 11.2318 22.2768 11.4471 22.3202 11.6855C22.3695 11.8925 22.3577 12.1084 22.2857 12.308C22.2138 12.5075 22.0848 12.6819 21.9166 12.812L17.2945 17.6824C16.9731 18.0233 16.5415 18.2464 16.0716 18.318C15.6016 18.3896 15.1191 18.3061 14.7032 18.0824C14.2873 17.8586 13.9628 17.5091 13.7843 17.0901C13.6058 16.6711 13.5848 16.2051 13.7253 15.772L15.1144 11.6855C15.1717 11.5324 15.1717 11.3647 15.1144 11.2115C15.0867 11.1238 15.04 11.043 14.9779 10.9748C14.9158 10.9066 14.8398 10.852 14.7549 10.8147C14.6699 10.7773 14.5782 10.7581 14.4854 10.7583C14.3926 10.7585 14.301 10.7782 14.2162 10.8159C14.1314 10.8536 14.0557 10.9086 13.9939 10.977C13.9322 11.0454 13.8858 11.1265 13.8586 11.2143C13.8313 11.3021 13.824 11.3947 13.8371 11.4855L12.4454 15.56C12.1783 16.4159 12.2932 17.3408 12.7642 18.1046C13.2352 18.8684 14.0221 19.4025 14.9254 19.5741C15.8287 19.7458 16.7614 19.541 17.5125 19.0039C18.2636 18.4668 18.7629 17.6448 18.8943 16.7274C18.9066 16.6362 18.9584 16.5539 19.0374 16.4978C19.1164 16.4417 19.2166 16.4166 19.3151 16.4277C19.4135 16.4388 19.5022 16.4852 19.5657 16.5578C19.6292 16.6304 19.662 16.7233 19.6568 16.8177C19.6566 16.9167 19.6441 17.0154 19.6195 17.1124C19.399 18.325 18.6957 19.4044 17.6579 20.1163C16.62 20.8281 15.3392 21.1148 14.0937 20.9179C12.8481 20.721 11.7264 20.0558 10.9783 19.0713C10.2301 18.0868 9.9154 16.8593 10.1028 15.6617L11.5035 11.6289C11.6939 11.1022 12.0078 10.6291 12.4198 10.247C12.8318 9.86494 13.329 9.58284 13.8723 9.42458C14.4156 9.26632 14.9894 9.23594 15.5467 9.3359C16.104 9.43585 16.63 9.66293 17.0794 9.9994L17.8103 10.5388C17.9718 10.6669 18.2094 10.6386 18.3351 10.4661C18.46 10.2942 18.4207 10.0543 18.2594 9.9264L17.5264 9.387C16.9562 8.97214 16.2881 8.69553 15.5827 8.58033C14.8773 8.46512 14.1548 8.51454 13.4745 8.72456C12.7942 8.93459 12.1736 9.30003 11.6584 9.79161C11.1432 10.2832 10.7474 10.8836 10.5029 11.5492L9.10225 15.5828C8.84817 17.1497 9.25682 18.752 10.223 20.0061C11.1891 21.2602 12.6229 22.0573 14.1972 22.2164C15.7715 22.3755 17.3471 21.8823 18.5531 20.8492C19.7592 19.8161 20.4882 18.3319 20.5628 16.7505C20.5628 16.5347 20.5628 16.32 20.5378 16.1066C20.5122 15.9236 20.5422 15.7373 20.6248 15.5711C20.7073 15.4048 20.8385 15.2661 20.9999 15.1722L20.9998 15.1722L21 15.1721L21.172 15.0602L25.6364 10.3815C25.8737 10.1322 26.0299 9.81982 26.0901 9.48449C26.1503 9.14915 26.1122 8.80384 25.98 8.49047C25.8479 8.1771 25.6268 7.9093 25.345 7.71748C25.0632 7.52567 24.7322 7.41743 24.3916 7.406C24.0272 7.406 23.6751 7.536 23.3869 7.772L18.8946 12.5072C18.7351 12.6714 18.7353 12.9384 18.8949 13.1025C18.9766 13.1878 19.0866 13.2349 19.2008 13.2349C19.315 13.2349 19.4248 13.1878 19.5066 13.1025L24.0002 8.36734C24.1688 8.1844 24.4026 8.0824 24.6476 8.0824C24.7743 8.08705 24.8994 8.12058 25.0139 8.18076C25.1285 8.24095 25.2299 8.32629 25.3112 8.43096C25.3927 8.53572 25.4526 8.65751 25.4873 8.78795C25.522 8.91839 25.5307 9.05461 25.5132 9.18839C25.487 9.40294 25.3994 9.60378 25.2623 9.76822L20.7966 14.4468C19.9636 15.3129 19.7162 16.5813 20.1611 17.6866C20.1894 17.7525 20.2038 17.8229 20.2037 17.8941C20.2035 17.9653 20.1888 18.0356 20.1602 18.1014C20.1316 18.1671 20.0896 18.2269 20.0368 18.2768C19.9839 18.3266 19.9214 18.365 19.8529 18.3897C19.7844 18.4144 19.7117 18.4249 19.6395 18.4206C19.5674 18.4162 19.4967 18.3971 19.4322 18.3645C19.3678 18.3318 19.3109 18.2861 19.2654 18.2299C19.2198 18.1738 19.1868 18.1084 19.1685 18.0385C18.8751 17.3072 18.9889 16.4763 19.4731 15.8507L23.9369 11.1735C24.1742 10.9243 24.3304 10.6119 24.3906 10.2766C24.4508 9.94125 24.4127 9.59594 24.2805 9.28257C24.1483 8.9692 23.9273 8.7014 23.6455 8.50959C23.3637 8.31777 23.0327 8.20954 22.6921 8.1981C22.3276 8.1981 21.9755 8.3281 21.6873 8.5641L17.195 13.2993C17.0354 13.4636 17.0356 13.7299 17.1953 13.894C17.2771 13.9796 17.3871 14.0269 17.5014 14.0269C17.6157 14.0269 17.7257 13.9796 17.8075 13.894L22.2997 9.15866C22.4682 8.97574 22.7018 8.87373 22.9466 8.87373C23.0733 8.87839 23.1984 8.91192 23.3129 8.9721C23.4275 9.03228 23.5289 9.11763 23.6102 9.22229C23.6917 9.32706 23.7516 9.44884 23.7863 9.57927C23.821 9.70971 23.8297 9.84593 23.8122 9.97973C23.786 10.1943 23.6984 10.3952 23.5613 10.5594L19.0909 15.2381C18.2579 16.1041 18.0105 17.3729 18.4554 18.4781C18.4837 18.5441 18.4981 18.6144 18.498 18.6857C18.4978 18.7569 18.4831 18.8272 18.4545 18.893C18.4259 18.9588 18.3839 19.0186 18.3311 19.0684C18.2783 19.1183 18.2157 19.1566 18.1472 19.1814C18.0787 19.2061 18.006 19.2166 17.9338 19.2123C17.8617 19.2079 17.791 19.1887 17.7266 19.1561C17.6621 19.1235 17.6053 19.0778 17.5597 19.0216C17.5142 18.9654 17.4812 18.9 17.4629 18.8302C17.1695 18.0989 17.2833 17.268 17.7675 16.6424L22.2313 11.9649C22.7246 11.447 22.7723 10.6447 22.3201 10.3813L22.3202 10.3815Z" fill="white"/>
        </svg>
      ),
      description: "Connect with Phantom wallet (Solana)",
    }
  ];

  // Handle wallet connection
  const handleConnectWallet = async (walletType: WalletType) => {
    setIsConnecting(true);
    setSelectedWallet(walletType);
    
    try {
      await connectWallet(walletType);
      toast({
        title: "Wallet Connected",
        description: `Successfully connected to ${walletType} wallet`,
      });
      onClose();
    } catch (error: any) {
      console.error("Error connecting to wallet:", error);
      toast({
        title: "Connection Failed",
        description: error?.message || "Failed to connect to wallet. Please try again.",
        variant: "destructive",
      });
    } finally {
      setIsConnecting(false);
      setSelectedWallet(null);
    }
  };

  return (
    <Dialog open={isOpen} onOpenChange={(open) => !open && onClose()}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>Connect Wallet</DialogTitle>
          <DialogDescription>
            Choose a wallet to connect to Bet.99
          </DialogDescription>
        </DialogHeader>
        
        <div className="grid gap-4 py-4">
          {walletOptions.map((wallet) => (
            <Button
              key={wallet.id}
              variant="outline"
              className={`flex items-center justify-start p-4 h-auto ${
                isConnecting && selectedWallet === wallet.id
                  ? "bg-gray-100 dark:bg-gray-800"
                  : ""
              }`}
              disabled={isConnecting}
              onClick={() => handleConnectWallet(wallet.id)}
            >
              <div className="flex items-center w-full">
                <div className="flex-shrink-0 mr-3">{wallet.icon}</div>
                <div className="flex-1">
                  <p className="font-medium text-left">{wallet.name}</p>
                  <p className="text-sm text-muted-foreground text-left">{wallet.description}</p>
                </div>
                {isConnecting && selectedWallet === wallet.id && (
                  <div className="w-5 h-5 border-2 border-t-transparent border-primary rounded-full animate-spin ml-2"></div>
                )}
              </div>
            </Button>
          ))}
        </div>
      </DialogContent>
    </Dialog>
  );
}